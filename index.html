<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-BET | Enterprise Gaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6; --secondary: #f59e0b; --dark-bg: #05080f;
            --text-main: #ffffff; --text-dim: #94a3b8; --border: rgba(255, 255, 255, 0.1);
            --success: #10b981; --danger: #ef4444; --nav-height: 80px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--dark-bg); color: var(--text-main); 
            font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; 
        }
        body.modal-open { overflow: hidden; }

        /* --- Components --- */
        .btn-link { text-decoration: none; }
        .hidden { display: none !important; }
        
        /* Transition for Balance Changes */
        .balance-val { 
            color: var(--success); font-weight: 800; 
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-block;
        }
        .balance-update { transform: scale(1.15); }

        .logout-btn { 
            background: transparent; border: none; cursor: pointer; 
            font-size: 14px; margin-left: 10px; color: var(--text-dim);
            transition: color 0.2s;
        }
        .logout-btn:hover { color: var(--danger); }

        /* --- Navigation --- */
        .navbar { 
            position: fixed; top: 0; width: 100%; z-index: 2000; 
            background: rgba(5, 8, 15, 0.95); backdrop-filter: blur(15px); 
            border-bottom: 1px solid var(--border); height: var(--nav-height); 
        }
        .nav-container { 
            max-width: 1800px; margin: 0 auto; padding: 0 30px; 
            display: flex; justify-content: space-between; align-items: center; height: 100%; 
        }
        .logo { font-size: 26px; font-weight: 800; color: white; text-decoration: none; }
        .logo span { color: var(--primary); }

        .nav-links { display: flex; gap: 25px; align-items: center; list-style: none; }
        .nav-item { color: var(--text-dim); font-weight: 600; font-size: 14px; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { color: white; }

        #menuToggle { display: none; background: none; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 8px; cursor: pointer; }

        @media (max-width: 992px) {
            #menuToggle { display: block !important; }
            .nav-links { 
                position: fixed; top: var(--nav-height); left: 0; width: 100%; 
                background: #05080f; flex-direction: column; padding: 40px; 
                border-bottom: 1px solid var(--border); transform: translateY(-110%);
                transition: transform 0.4s ease;
            }
            .nav-links.active { transform: translateY(0); }
        }

        /* --- Modal & Loader --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 5000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #0f172a; padding: 30px; border-radius: 20px; border: 1px solid var(--border); width: 90%; max-width: 400px; text-align: center; }

        .sync-spinner { width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .user-pill { display: flex; align-items: center; gap: 12px; background: rgba(255,255,255,0.05); padding: 6px 16px; border-radius: 50px; border: 1px solid var(--border); }
        .btn { padding: 12px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; transition: 0.2s; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: white; }
    </style>
</head>

<body 
    data-api-key="YOUR_KEY" 
    data-auth-domain="YOUR_DOMAIN" 
    data-project-id="YOUR_ID"
    data-bucket="YOUR_BUCKET"
    data-sender-id="YOUR_SENDER"
    data-app-id="YOUR_APP"
>

    <div id="logoutModal" class="modal-overlay hidden" role="dialog" aria-modal="true">
        <div class="modal-content">
            <h3>Confirm Logout</h3>
            <p style="color:var(--text-dim); margin: 15px 0;">Your active session and live bets will be paused.</p>
            <div style="display:flex; gap:12px; justify-content:center;">
                <button id="cancelBtn" class="btn btn-outline">Cancel</button>
                <button id="confirmBtn" class="btn btn-primary" style="background:var(--danger)">Logout</button>
            </div>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div style="display:flex; align-items:center; gap:20px;">
                <button id="menuToggle" aria-label="Toggle Menu">â˜°</button>
                <a href="index.html" class="logo">X-<span>BET</span></a>
            </div>
            
            <ul id="navLinks" class="nav-links">
                <li><a href="index.html" class="nav-item active btn-link">Home</a></li>
                <li><a href="games.html" class="nav-item btn-link">Games</a></li>
                <li><a href="dashboard.html" id="link-dash" class="nav-item btn-link hidden">Dashboard</a></li>
            </ul>

            <div id="authArea">
                <div class="sync-spinner" role="status"></div>
            </div>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 1. Browser-Safe Config Fetching
        const ds = document.body.dataset;
        const firebaseConfig = {
            apiKey: ds.apiKey,
            authDomain: ds.authDomain,
            projectId: ds.projectId,
            storageBucket: ds.bucket,
            messagingSenderId: ds.senderId,
            appId: ds.appId
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let unsubscribeFirestore = null;
        let lastBalance = null;

        onAuthStateChanged(auth, (user) => {
            if (unsubscribeFirestore) unsubscribeFirestore();
            if (user) {
                unsubscribeFirestore = onSnapshot(doc(db, "users", user.uid), (snap) => {
                    if (snap.exists()) renderUserUI(snap.data());
                }, (error) => console.error("Firestore sync failed"));
            } else {
                renderGuestUI();
            }
        });

        function renderUserUI(data) {
            const currentBalance = Number(data.balance) || 0;
            document.getElementById('link-dash').classList.remove('hidden');
            
            const authArea = document.getElementById('authArea');
            authArea.innerHTML = `
                <div class="user-pill">
                    <span id="balDisplay" class="balance-val">$${currentBalance.toLocaleString()}</span>
                    <span style="font-size:12px; font-weight:600;">${data.username}</span>
                    <button id="openLogout" class="logout-btn">Logout</button>
                </div>
            `;

            // Balance Update Animation
            if (lastBalance !== null && lastBalance !== currentBalance) {
                const balEl = document.getElementById('balDisplay');
                balEl.classList.add('balance-update');
                setTimeout(() => balEl.classList.remove('balance-update'), 300);
            }
            lastBalance = currentBalance;

            document.getElementById('openLogout').onclick = toggleModal;
        }

        function renderGuestUI() {
            document.getElementById('link-dash').classList.add('hidden');
            document.getElementById('authArea').innerHTML = `
                <a href="login.html" class="btn btn-primary btn-link">Join Now</a>
            `;
        }

        function toggleModal() {
            const modal = document.getElementById('logoutModal');
            const isOpening = modal.classList.toggle('hidden');
            document.body.classList.toggle('modal-open', !isOpening);
            if (!isOpening) document.getElementById('cancelBtn').focus();
        }

        document.getElementById('cancelBtn').onclick = toggleModal;
        document.getElementById('confirmBtn').onclick = () => signOut(auth).then(() => window.location.reload());

        document.getElementById('menuToggle').onclick = (e) => {
            e.stopPropagation();
            document.getElementById('navLinks').classList.toggle('active');
        };

        document.addEventListener('click', () => document.getElementById('navLinks').classList.remove('active'));
        window.onbeforeunload = () => { if (unsubscribeFirestore) unsubscribeFirestore(); };
    </script>
</body>
</html>
