<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-BET - Admin Control Panel v5.0</title>
    <!-- Sync Systems -->
    <script src="cross-browser-sync.js"></script>
    <style>
        /* [ALL YOUR EXISTING CSS REMAINS UNCHANGED] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --admin-primary: #3b82f6;
            --admin-secondary: #1d4ed8;
            --admin-danger: #ef4444;
            --admin-success: #10b981;
            --admin-warning: #f59e0b;
            --admin-dark: #0f172a;
            --admin-light: #f8fafc;
            --admin-gray: #64748b;
        }

        body {
            background: linear-gradient(135deg, var(--admin-dark), #1e293b);
            color: var(--admin-light);
            min-height: 100vh;
        }

        .admin-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-bottom: 3px solid var(--admin-primary);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .admin-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-logo h1 {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--admin-primary);
        }

        .admin-logo span {
            color: var(--admin-success);
        }

        .admin-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .admin-user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-balance {
            background: rgba(16, 185, 129, 0.15);
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .balance-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: 800;
            color: #10b981;
            margin-top: 4px;
        }

        .admin-logout-btn {
            background: var(--admin-danger);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-logout-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Main Container */
        .admin-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Admin Stats Grid */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }

        .admin-stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--admin-primary);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.9rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 800;
            margin: 0.5rem 0;
        }

        .stat-positive { color: var(--admin-success); }
        .stat-negative { color: var(--admin-danger); }
        .stat-primary { color: var(--admin-primary); }

        /* Admin Actions */
        .admin-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .admin-action-btn {
            background: linear-gradient(135deg, var(--admin-primary), var(--admin-secondary));
            color: white;
            border: none;
            padding: 1.5rem;
            border-radius: 14px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
        }

        .admin-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
        }

        .admin-action-btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .admin-action-btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Admin Sections */
        .admin-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--admin-light);
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: white;
            width: 300px;
            font-size: 0.9rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--admin-primary);
        }

        /* Transfer Section */
        .transfer-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr) auto;
            gap: 1rem;
            align-items: end;
            margin-bottom: 2rem;
        }

        .admin-form-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .admin-form-group label {
            font-size: 0.9rem;
            color: #94a3b8;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-form-group input, .admin-form-group select {
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .admin-form-group input:focus, .admin-form-group select:focus {
            outline: none;
            border-color: var(--admin-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .admin-transfer-btn {
            background: var(--admin-success);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
            height: fit-content;
        }

        .admin-transfer-btn:hover {
            background: #059669;
        }

        /* Users Table */
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .users-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .users-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .users-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .user-action-btn {
            background: rgba(59, 130, 246, 0.2);
            color: var(--admin-primary);
            border: 1px solid rgba(59, 130, 246, 0.4);
            padding: 6px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .user-action-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .password-display {
            font-family: monospace;
            background: rgba(0,0,0,0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.85rem;
            color: #94a3b8;
        }

        /* Transactions Log */
        .transactions-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 10px;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transaction-deposit { border-left-color: var(--admin-success); }
        .transaction-withdrawal { border-left-color: var(--admin-danger); }
        .transaction-transfer { border-left-color: var(--admin-primary); }
        .transaction-admin { border-left-color: var(--admin-warning); }
        .transaction-win { border-left-color: #22c55e; }
        .transaction-loss { border-left-color: #ef4444; }
        .transaction-game { border-left-color: #8b5cf6; }

        .transaction-code {
            background: rgba(59, 130, 246, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.85rem;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* Modal */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .admin-modal-content {
            background: rgba(15, 23, 42, 0.95);
            margin: 5% auto;
            padding: 2.5rem;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            border: 2px solid var(--admin-primary);
            position: relative;
        }

        .modal-close {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            color: #94a3b8;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: white;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .admin-container {
                padding: 1.5rem;
            }
            
            .transfer-controls {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .admin-nav {
                flex-direction: column;
                gap: 1rem;
            }
            
            .admin-user-info {
                flex-direction: column;
                width: 100%;
            }
            
            .admin-balance {
                width: 100%;
                text-align: center;
            }
            
            .search-box {
                width: 100%;
            }
            
            .users-table {
                display: block;
                overflow-x: auto;
            }
        }

        /* Sync Status */
        .sync-status {
            background: rgba(59, 130, 246, 0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            border-left: 4px solid var(--admin-primary);
        }

        /* Win/Loss Stats */
        .win-loss-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 10px;
        }

        .win-stat { color: var(--admin-success); }
        .loss-stat { color: var(--admin-danger); }

        /* Alert Styles */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--admin-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <nav class="admin-nav">
            <div class="admin-logo">
                <h1>X<span>-BET</span> ADMIN</h1>
                <div class="admin-badge">v5.0 SECURE SYSTEM</div>
            </div>
            
            <div class="admin-user-info">
                <div class="admin-balance">
                    <div class="balance-label">Admin Balance</div>
                    <div class="balance-amount" id="adminBalance">$14,050,000.00</div>
                </div>
                <div style="color: #94a3b8;">Logged in as: <strong id="adminUsername">admin_master</strong></div>
                <button class="admin-logout-btn" onclick="adminLogout()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    Logout
                </button>
            </div>
        </nav>
    </header>

    <!-- Main Container -->
    <main class="admin-container">
        <!-- Sync Status -->
        <div class="sync-status" id="syncStatus">
            üîÑ Connecting to cross-browser sync system...
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Admin Stats -->
        <div class="admin-stats-grid">
            <div class="admin-stat-card">
                <div class="stat-header">
                    <div class="stat-title">Total Platform Balance</div>
                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2);">üí∞</div>
                </div>
                <div class="stat-value stat-positive" id="totalBalance">$0.00</div>
                <div style="color: #94a3b8; font-size: 0.9rem;">All users + admin funds</div>
            </div>

            <div class="admin-stat-card">
                <div class="stat-header">
                    <div class="stat-title">Total Users</div>
                    <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2);">üë•</div>
                </div>
                <div class="stat-value stat-primary" id="totalUsers">0</div>
                <div style="color: #94a3b8; font-size: 0.9rem;">Active registered users</div>
            </div>

            <div class="admin-stat-card">
                <div class="stat-header">
                    <div class="stat-title">Total Winnings</div>
                    <div class="stat-icon" style="background: rgba(34, 197, 94, 0.2);">üèÜ</div>
                </div>
                <div class="stat-value stat-positive" id="totalWins">$0.00</div>
                <div style="color: #94a3b8; font-size: 0.9rem;">All user winnings combined</div>
            </div>

            <div class="admin-stat-card">
                <div class="stat-header">
                    <div class="stat-title">Total Losses</div>
                    <div class="stat-icon" style="background: rgba(239, 68, 68, 0.2);">üìâ</div>
                </div>
                <div class="stat-value stat-negative" id="totalLosses">$0.00</div>
                <div style="color: #94a3b8; font-size: 0.9rem;">All user losses combined</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="admin-actions">
            <button class="admin-action-btn" onclick="openDepositModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                </svg>
                Deposit to User
            </button>
            <button class="admin-action-btn" onclick="openWithdrawModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Process Withdrawal
            </button>
            <button class="admin-action-btn success" onclick="openCreateUserModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Create New User
            </button>
            <button class="admin-action-btn" onclick="openAdminToAdminModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                </svg>
                Admin to Admin
            </button>
        </div>

        <!-- Transfer Section -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title">üí∏ Universal Transfer System</h2>
            </div>
            
            <div class="transfer-controls">
                <div class="admin-form-group">
                    <label for="transferFrom">From (Sender)</label>
                    <select id="transferFrom" onchange="updateTransferOptions()">
                        <option value="admin">This Admin (You)</option>
                        <option value="user">User Account</option>
                        <option value="other_admin">Other Admin</option>
                    </select>
                </div>
                
                <div class="admin-form-group">
                    <label for="transferTo">To (Receiver)</label>
                    <select id="transferTo" onchange="updateTransferOptions()">
                        <option value="user">User Account</option>
                        <option value="admin">This Admin (You)</option>
                        <option value="other_admin">Other Admin</option>
                    </select>
                </div>
                
                <div class="admin-form-group">
                    <label for="transferAmount">Amount ($)</label>
                    <input type="number" id="transferAmount" min="0.01" step="0.01" placeholder="0.00">
                </div>
                
                <div class="admin-form-group">
                    <label for="transactionCode">Transaction Code</label>
                    <input type="text" id="transactionCode" placeholder="Enter transaction code" list="userCodes">
                    <datalist id="userCodes">
                        <!-- Populated dynamically -->
                    </datalist>
                </div>
                
                <button class="admin-transfer-btn" onclick="processUniversalTransfer()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                    Execute Transfer
                </button>
            </div>
            
            <div style="margin-top: 1rem; color: #94a3b8; font-size: 0.9rem;">
                üí° <strong>Transfer Types Available:</strong><br>
                ‚Ä¢ <strong>Admin to User</strong>: You send money to any user<br>
                ‚Ä¢ <strong>User to Admin</strong>: User sends money to you<br>
                ‚Ä¢ <strong>Admin to Admin</strong>: Transfer between admin accounts<br>
                ‚Ä¢ <strong>User to User</strong>: Transfer between user accounts<br>
                ‚Ä¢ All transactions require valid transaction codes
            </div>
        </div>

        <!-- Users Management -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title">üë• Users Management</h2>
                <div>
                    <input type="text" class="search-box" placeholder="Search users..." oninput="searchUsers(this.value)">
                    <button onclick="forceSync()" style="margin-left: 10px; padding: 0.75rem 1.5rem; background: rgba(139, 92, 246, 0.2); color: #8b5cf6; border: 1px solid rgba(139, 92, 246, 0.4); border-radius: 10px; cursor: pointer;">
                        üîÑ Force Sync
                    </button>
                </div>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Password</th>
                            <th>Balance</th>
                            <th>Transaction Code</th>
                            <th>Status</th>
                            <th>Win/Loss</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 3rem; color: #94a3b8;">
                                <div class="spinner"></div>
                                Loading users data...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Transactions Log -->
        <div class="admin-section">
            <div class="section-header">
                <h2 class="section-title">üìã All Transactions Log</h2>
                <select class="search-box" onchange="filterTransactions(this.value)">
                    <option value="all">All Transactions</option>
                    <option value="deposit">Deposits</option>
                    <option value="withdrawal">Withdrawals</option>
                    <option value="transfer">Transfers</option>
                    <option value="admin_transfer">Admin Transfers</option>
                    <option value="win">Wins</option>
                    <option value="loss">Losses</option>
                    <option value="game">Game Results</option>
                </select>
            </div>
            
            <div class="transactions-log" id="transactionsLog">
                <div style="text-align: center; padding: 3rem; color: #94a3b8;">
                    <div class="spinner"></div>
                    Loading transactions...
                </div>
            </div>
        </div>
    </main>

    <!-- Deposit Modal -->
    <div id="depositModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="modal-close" onclick="closeDepositModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem; color: var(--admin-success);">üí∞ Deposit to User</h2>
            
            <div class="admin-form-group">
                <label>User Transaction Code</label>
                <input type="text" id="depositUserCode" placeholder="Enter user transaction code" list="userCodes">
            </div>
            
            <div class="admin-form-group">
                <label>Amount ($)</label>
                <input type="number" id="depositAmount" min="0.01" step="0.01" placeholder="0.00">
            </div>
            
            <div class="admin-form-group">
                <label>Description</label>
                <input type="text" id="depositDescription" placeholder="Reason for deposit">
            </div>
            
            <button class="admin-transfer-btn" onclick="processUserDeposit()" style="width: 100%; margin-top: 1.5rem;">
                Deposit Funds
            </button>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="modal-close" onclick="closeWithdrawModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem; color: var(--admin-danger);">üí∞ Process Withdrawal</h2>
            
            <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                <h4 style="color: #ef4444; margin-bottom: 0.5rem;">Pending Withdrawals</h4>
                <div id="pendingWithdrawalsList">
                    <!-- Pending withdrawals will be loaded here -->
                </div>
            </div>
            
            <div class="admin-form-group">
                <label>Withdrawal Transaction Code</label>
                <input type="text" id="withdrawalCode" placeholder="Enter withdrawal transaction code">
            </div>
            
            <div class="admin-form-group">
                <label>Status Update</label>
                <select id="withdrawalStatus">
                    <option value="completed">‚úÖ Complete</option>
                    <option value="rejected">‚ùå Reject</option>
                    <option value="processing">‚è≥ Processing</option>
                </select>
            </div>
            
            <button class="admin-transfer-btn" onclick="processWithdrawalStatus()" style="width: 100%; margin-top: 1.5rem; background: var(--admin-danger);">
                Update Status
            </button>
        </div>
    </div>

    <!-- Create User Modal -->
    <div id="createUserModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="modal-close" onclick="closeCreateUserModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem; color: var(--admin-success);">üë§ Create New User</h2>
            
            <div class="admin-form-group">
                <label>Username</label>
                <input type="text" id="newUsername" placeholder="Enter username">
            </div>
            
            <div class="admin-form-group">
                <label>Email</label>
                <input type="email" id="newUserEmail" placeholder="Enter email">
            </div>
            
            <div class="admin-form-group">
                <label>Initial Balance ($)</label>
                <input type="number" id="initialBalance" min="0" step="0.01" placeholder="0.00">
            </div>
            
            <div class="admin-form-group">
                <label>Password (Auto-generated secure)</label>
                <input type="text" id="newUserPassword" placeholder="Auto-generated" readonly>
            </div>
            
            <div class="admin-form-group">
                <label>Transaction Code (Auto-generated)</label>
                <input type="text" id="customTransactionCode" placeholder="Auto-generated" readonly>
            </div>
            
            <button class="admin-transfer-btn" onclick="createNewUser()" style="width: 100%; margin-top: 1.5rem;">
                Create User Account
            </button>
        </div>
    </div>

    <!-- Admin to Admin Modal -->
    <div id="adminToAdminModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="modal-close" onclick="closeAdminToAdminModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem; color: var(--admin-warning);">üëë Admin to Admin Transfer</h2>
            
            <div class="admin-form-group">
                <label>From Admin</label>
                <select id="fromAdmin">
                    <option value="admin_master">admin_master ($14,050,000.00)</option>
                </select>
            </div>
            
            <div class="admin-form-group">
                <label>To Admin</label>
                <select id="toAdmin">
                    <option value="finance_manager">finance_manager ($0.00)</option>
                    <option value="support_admin">support_admin ($0.00)</option>
                </select>
            </div>
            
            <div class="admin-form-group">
                <label>Amount ($)</label>
                <input type="number" id="adminTransferAmount" min="0.01" step="0.01" placeholder="0.00">
            </div>
            
            <div class="admin-form-group">
                <label>Description</label>
                <input type="text" id="adminTransferDescription" placeholder="Reason for transfer">
            </div>
            
            <button class="admin-transfer-btn" onclick="processAdminToAdminTransfer()" style="width: 100%; margin-top: 1.5rem; background: var(--admin-warning);">
                Transfer Between Admins
            </button>
        </div>
    </div>

    <!-- Game Results Modal -->
    <div id="gameResultsModal" class="admin-modal">
        <div class="admin-modal-content">
            <span class="modal-close" onclick="closeGameResultsModal()">&times;</span>
            <h2 style="margin-bottom: 1.5rem; color: var(--admin-primary);">üéÆ Manual Game Result Entry</h2>
            
            <div class="admin-form-group">
                <label>User Transaction Code</label>
                <input type="text" id="gameUserCode" placeholder="Enter user transaction code">
            </div>
            
            <div class="admin-form-group">
                <label>Game Type</label>
                <select id="gameType">
                    <option value="slots">Slots</option>
                    <option value="blackjack">Blackjack</option>
                    <option value="roulette">Roulette</option>
                    <option value="poker">Poker</option>
                    <option value="baccarat">Baccarat</option>
                    <option value="crash">Crash Game</option>
                </select>
            </div>
            
            <div class="admin-form-group">
                <label>Result</label>
                <select id="gameResult">
                    <option value="win">Win</option>
                    <option value="loss">Loss</option>
                </select>
            </div>
            
            <div class="admin-form-group">
                <label>Amount ($)</label>
                <input type="number" id="gameAmount" min="0.01" step="0.01" placeholder="0.00">
            </div>
            
            <div class="admin-form-group">
                <label>Game Details</label>
                <input type="text" id="gameDetails" placeholder="Game details (e.g., 'Hit Blackjack')">
            </div>
            
            <button class="admin-transfer-btn" onclick="processManualGameResult()" style="width: 100%; margin-top: 1.5rem;">
                Record Game Result
            </button>
        </div>
    </div>

    <script>
        // üîê X-BET ADMIN PANEL v5.0 - COMPLETE CENTRALIZED STORAGE SYSTEM
        class XBetStorage {
            constructor() {
                this.version = '5.0';
                this.initializeStorage();
            }

            initializeStorage() {
                // Master storage for the entire platform
                if (!localStorage.getItem('XBET_MASTER_STORE')) {
                    const masterStore = {
                        version: this.version,
                        created: new Date().toISOString(),
                        lastUpdated: new Date().toISOString(),
                        totalUsers: 0,
                        totalTransactions: 0,
                        totalPlatformBalance: 0,
                        totalWins: 0,
                        totalLosses: 0,
                        users: {}, // Index of all users
                        admins: {
                            admin_master: {
                                username: 'admin_master',
                                balance: 14050000.00,
                                password: this.hashPassword('Master@Xbet2024!'),
                                permissions: ['all'],
                                hidden: true,
                                created: new Date().toISOString()
                            },
                            finance_manager: {
                                username: 'finance_manager',
                                balance: 0.00,
                                password: this.hashPassword('Finance@Xbet2024!'),
                                permissions: ['view', 'deposit', 'withdrawal'],
                                hidden: true,
                                created: new Date().toISOString()
                            },
                            support_admin: {
                                username: 'support_admin',
                                balance: 0.00,
                                password: this.hashPassword('Support@Xbet2024!'),
                                permissions: ['view', 'support'],
                                hidden: true,
                                created: new Date().toISOString()
                            }
                        },
                        security: {
                            encryptionKey: this.generateEncryptionKey(),
                            lastBackup: new Date().toISOString(),
                            loginAttempts: {},
                            ipWhitelist: []
                        },
                        settings: {
                            minDeposit: 10,
                            maxDeposit: 10000,
                            minWithdrawal: 20,
                            maxWithdrawal: 5000,
                            commissionRate: 0.05
                        }
                    };
                    localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));
                }

                // Initialize user data storage
                if (!localStorage.getItem('XBET_USERS_DATA')) {
                    localStorage.setItem('XBET_USERS_DATA', JSON.stringify({}));
                }

                // Initialize transactions storage
                if (!localStorage.getItem('XBET_TRANSACTIONS')) {
                    localStorage.setItem('XBET_TRANSACTIONS', JSON.stringify([]));
                }

                // Initialize game history
                if (!localStorage.getItem('XBET_GAME_HISTORY')) {
                    localStorage.setItem('XBET_GAME_HISTORY', JSON.stringify([]));
                }
            }

            hashPassword(password) {
                // Simple hash for demonstration (in production, use proper hashing)
                return btoa(password + 'X-BET-SALT-2024');
            }

            generateEncryptionKey() {
                return Array.from(crypto.getRandomValues(new Uint8Array(32)))
                    .map(b => b.toString(16).padStart(2, '0')).join('');
            }

            generateTransactionCode(username) {
                const timestamp = Date.now().toString(36).toUpperCase();
                const random = Math.random().toString(36).substring(2, 6).toUpperCase();
                return `XBET-${username.substring(0, 3).toUpperCase()}-${timestamp}-${random}`;
            }

            generateStrongPassword(length = 12) {
                const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                let password = '';
                for (let i = 0; i < length; i++) {
                    password += charset.charAt(Math.floor(Math.random() * charset.length));
                }
                return password;
            }

            // USER MANAGEMENT
            registerUser(username, email, password, initialBalance = 0) {
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));

                if (masterStore.users[username]) {
                    throw new Error('Username already exists');
                }

                if (Object.values(masterStore.users).some(u => u.email === email)) {
                    throw new Error('Email already registered');
                }

                const transactionCode = this.generateTransactionCode(username);
                const userId = 'USER-' + Date.now();

                // Create user object
                const userObj = {
                    id: userId,
                    username: username,
                    email: email,
                    password: this.hashPassword(password),
                    transactionCode: transactionCode,
                    balance: parseFloat(initialBalance),
                    gameBalance: 0,
                    totalDeposited: 0,
                    totalWithdrawn: 0,
                    totalWon: 0,
                    totalLost: 0,
                    status: 'active',
                    isVerified: false,
                    isAdmin: false,
                    created: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    lastActivity: new Date().toISOString(),
                    ipAddresses: [],
                    security: {
                        twoFactorEnabled: false,
                        lastPasswordChange: new Date().toISOString()
                    }
                };

                // Update master store
                masterStore.users[username] = {
                    id: userId,
                    email: email,
                    balance: parseFloat(initialBalance),
                    status: 'active',
                    created: new Date().toISOString(),
                    transactionCode: transactionCode
                };
                masterStore.totalUsers++;
                masterStore.totalPlatformBalance += parseFloat(initialBalance);
                masterStore.lastUpdated = new Date().toISOString();

                // Save user data
                usersData[username] = userObj;

                // Record initial transaction if balance > 0
                if (initialBalance > 0) {
                    this.recordTransaction({
                        type: 'deposit',
                        from: 'system',
                        to: username,
                        amount: parseFloat(initialBalance),
                        description: 'Initial deposit on account creation',
                        status: 'completed',
                        category: 'account_creation'
                    });
                }

                // Save all data
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));
                localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));

                return {
                    success: true,
                    user: userObj,
                    message: 'User registered successfully'
                };
            }

            loginUser(username, password) {
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));

                if (!usersData[username]) {
                    throw new Error('User not found');
                }

                const user = usersData[username];

                if (user.password !== this.hashPassword(password)) {
                    // Track failed login attempts
                    const security = JSON.parse(localStorage.getItem('XBET_SECURITY_LOG') || '{}');
                    security[username] = security[username] || { attempts: 0, lastAttempt: null };
                    security[username].attempts++;
                    security[username].lastAttempt = new Date().toISOString();
                    localStorage.setItem('XBET_SECURITY_LOG', JSON.stringify(security));

                    throw new Error('Invalid password');
                }

                if (user.status !== 'active') {
                    throw new Error('Account is ' + user.status);
                }

                // Update user data
                user.lastLogin = new Date().toISOString();
                user.lastActivity = new Date().toISOString();
                usersData[username] = user;
                localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));

                // Reset failed attempts
                const security = JSON.parse(localStorage.getItem('XBET_SECURITY_LOG') || '{}');
                if (security[username]) {
                    security[username].attempts = 0;
                    localStorage.setItem('XBET_SECURITY_LOG', JSON.stringify(security));
                }

                return {
                    success: true,
                    user: {
                        username: user.username,
                        email: user.email,
                        balance: user.balance,
                        transactionCode: user.transactionCode,
                        totalWon: user.totalWon,
                        totalLost: user.totalLost
                    },
                    session: this.generateSessionToken(username)
                };
            }

            loginAdmin(username, password) {
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));

                if (!masterStore.admins[username]) {
                    throw new Error('Admin not found');
                }

                const admin = masterStore.admins[username];

                if (admin.password !== this.hashPassword(password)) {
                    throw new Error('Invalid admin password');
                }

                return {
                    success: true,
                    admin: {
                        username: admin.username,
                        balance: admin.balance,
                        permissions: admin.permissions
                    },
                    session: this.generateSessionToken(username, 'admin')
                };
            }

            generateSessionToken(username, type = 'user') {
                const token = btoa(`${username}:${type}:${Date.now()}:${Math.random()}`);
                const session = {
                    token: token,
                    username: username,
                    type: type,
                    created: new Date().toISOString(),
                    expires: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours
                };

                const sessions = JSON.parse(localStorage.getItem('XBET_SESSIONS') || '{}');
                sessions[token] = session;
                localStorage.setItem('XBET_SESSIONS', JSON.stringify(sessions));

                return token;
            }

            // TRANSACTION MANAGEMENT
            recordTransaction(transaction) {
                const transactions = JSON.parse(localStorage.getItem('XBET_TRANSACTIONS'));
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));

                const tx = {
                    id: 'TXN-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6),
                    timestamp: new Date().toISOString(),
                    ...transaction
                };

                // Update balances based on transaction type
                switch(tx.type) {
                    case 'deposit':
                        if (tx.to && usersData[tx.to]) {
                            usersData[tx.to].balance += tx.amount;
                            usersData[tx.to].totalDeposited += tx.amount;
                            masterStore.totalPlatformBalance += tx.amount;
                        }
                        break;

                    case 'withdrawal':
                        if (tx.from && usersData[tx.from]) {
                            usersData[tx.from].balance -= tx.amount;
                            usersData[tx.from].totalWithdrawn += tx.amount;
                            masterStore.totalPlatformBalance -= tx.amount;
                        }
                        break;

                    case 'transfer':
                        if (tx.from && usersData[tx.from]) {
                            usersData[tx.from].balance -= tx.amount;
                        }
                        if (tx.to && usersData[tx.to]) {
                            usersData[tx.to].balance += tx.amount;
                        }
                        break;

                    case 'admin_transfer':
                        if (tx.from && masterStore.admins[tx.from]) {
                            masterStore.admins[tx.from].balance -= tx.amount;
                        }
                        if (tx.to && masterStore.admins[tx.to]) {
                            masterStore.admins[tx.to].balance += tx.amount;
                        }
                        break;

                    case 'win':
                        if (tx.to && usersData[tx.to]) {
                            usersData[tx.to].balance += tx.amount;
                            usersData[tx.to].totalWon += tx.amount;
                            masterStore.totalWins += tx.amount;
                            masterStore.totalPlatformBalance += tx.amount;
                        }
                        break;

                    case 'loss':
                        if (tx.from && usersData[tx.from]) {
                            usersData[tx.from].balance -= tx.amount;
                            usersData[tx.from].totalLost += tx.amount;
                            masterStore.totalLosses += tx.amount;
                            masterStore.totalPlatformBalance -= tx.amount;
                        }
                        break;
                }

                // Save all data
                transactions.push(tx);
                masterStore.totalTransactions++;
                masterStore.lastUpdated = new Date().toISOString();

                localStorage.setItem('XBET_TRANSACTIONS', JSON.stringify(transactions));
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));
                localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));

                return tx;
            }

            // GAME MANAGEMENT
            recordGameResult(username, gameType, result, amount, details = '') {
                const gameHistory = JSON.parse(localStorage.getItem('XBET_GAME_HISTORY'));
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));

                if (!usersData[username]) {
                    throw new Error('User not found');
                }

                const gameRecord = {
                    id: 'GAME-' + Date.now(),
                    username: username,
                    gameType: gameType,
                    result: result,
                    amount: parseFloat(amount),
                    details: details,
                    timestamp: new Date().toISOString(),
                    processedBy: 'system'
                };

                // Update user balance and stats
                if (result === 'win') {
                    usersData[username].balance += parseFloat(amount);
                    usersData[username].totalWon += parseFloat(amount);
                    masterStore.totalWins += parseFloat(amount);
                    masterStore.totalPlatformBalance += parseFloat(amount);
                } else if (result === 'loss') {
                    usersData[username].balance -= parseFloat(amount);
                    usersData[username].totalLost += parseFloat(amount);
                    masterStore.totalLosses += parseFloat(amount);
                    masterStore.totalPlatformBalance -= parseFloat(amount);
                }

                // Record transaction
                this.recordTransaction({
                    type: result,
                    from: result === 'loss' ? username : 'system',
                    to: result === 'win' ? username : 'system',
                    amount: parseFloat(amount),
                    description: `${gameType} game: ${details}`,
                    status: 'completed',
                    category: 'game_result'
                });

                // Save game history
                gameHistory.push(gameRecord);
                localStorage.setItem('XBET_GAME_HISTORY', JSON.stringify(gameHistory));
                localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));

                return gameRecord;
            }

            // DATA RETRIEVAL
            getAllUsers() {
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
                return Object.values(usersData);
            }

            getAllTransactions(limit = 100) {
                const transactions = JSON.parse(localStorage.getItem('XBET_TRANSACTIONS'));
                return transactions.slice(-limit).reverse();
            }

            getAllGameHistory(limit = 50) {
                const gameHistory = JSON.parse(localStorage.getItem('XBET_GAME_HISTORY'));
                return gameHistory.slice(-limit).reverse();
            }

            getAdminStats() {
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));

                let totalUserBalance = 0;
                let totalWins = 0;
                let totalLosses = 0;

                Object.values(usersData).forEach(user => {
                    totalUserBalance += user.balance;
                    totalWins += user.totalWon;
                    totalLosses += user.totalLost;
                });

                return {
                    totalUsers: masterStore.totalUsers,
                    totalTransactions: masterStore.totalTransactions,
                    totalPlatformBalance: masterStore.totalPlatformBalance,
                    totalUserBalance: totalUserBalance,
                    totalWins: totalWins,
                    totalLosses: totalLosses,
                    adminBalances: Object.keys(masterStore.admins).reduce((acc, admin) => {
                        acc[admin] = masterStore.admins[admin].balance;
                        return acc;
                    }, {})
                };
            }

            // UTILITY METHODS
            getUserByTransactionCode(code) {
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
                return Object.values(usersData).find(user => 
                    user.transactionCode === code || 
                    user.transactionCode === code.toUpperCase()
                );
            }

            updateUserBalance(username, amount, type = 'deposit') {
                const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));

                if (!usersData[username]) {
                    throw new Error('User not found');
                }

                if (type === 'deposit') {
                    usersData[username].balance += parseFloat(amount);
                    usersData[username].totalDeposited += parseFloat(amount);
                    masterStore.totalPlatformBalance += parseFloat(amount);
                } else if (type === 'withdrawal') {
                    if (usersData[username].balance < parseFloat(amount)) {
                        throw new Error('Insufficient balance');
                    }
                    usersData[username].balance -= parseFloat(amount);
                    usersData[username].totalWithdrawn += parseFloat(amount);
                    masterStore.totalPlatformBalance -= parseFloat(amount);
                }

                localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));

                return usersData[username];
            }

            backupData() {
                const backup = {
                    timestamp: new Date().toISOString(),
                    masterStore: JSON.parse(localStorage.getItem('XBET_MASTER_STORE')),
                    usersData: JSON.parse(localStorage.getItem('XBET_USERS_DATA')),
                    transactions: JSON.parse(localStorage.getItem('XBET_TRANSACTIONS')),
                    gameHistory: JSON.parse(localStorage.getItem('XBET_GAME_HISTORY'))
                };

                const backups = JSON.parse(localStorage.getItem('XBET_BACKUPS') || '[]');
                backups.push(backup);
                if (backups.length > 10) backups.shift(); // Keep only last 10 backups
                localStorage.setItem('XBET_BACKUPS', JSON.stringify(backups));

                return backup;
            }
        }

        // üîê ADMIN PANEL CONTROLLER
        class AdminPanel {
            constructor() {
                this.storage = new XBetStorage();
                this.currentAdmin = null;
                this.adminData = null;
                this.allUsers = [];
                this.allTransactions = [];
                this.allGames = [];
            }

            async init() {
                this.checkAdminAuth();
                this.loadAdminData();
                await this.loadAllData();
                this.updateDisplay();
                this.setupEventListeners();
                this.updateSyncStatus();
            }

            checkAdminAuth() {
                const adminSession = localStorage.getItem('admin_session');
                const adminUser = localStorage.getItem('admin_user');
                
                if (!adminSession || !adminUser) {
                    window.location.href = 'admin.login.html';
                    return;
                }
                
                try {
                    this.currentAdmin = adminUser;
                    const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                    
                    if (!masterStore.admins[this.currentAdmin]) {
                        throw new Error('Unauthorized admin access');
                    }
                    
                    document.getElementById('adminUsername').textContent = this.currentAdmin;
                    this.updateAdminBalance();
                    
                } catch (error) {
                    console.error('Session error:', error);
                    window.location.href = 'admin.login.html';
                }
            }

            loadAdminData() {
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                if (masterStore.admins[this.currentAdmin]) {
                    this.adminData = masterStore.admins[this.currentAdmin];
                } else {
                    this.adminData = {
                        username: this.currentAdmin,
                        balance: this.currentAdmin === 'admin_master' ? 14050000.00 : 0.00,
                        permissions: ['all']
                    };
                }
                this.updateAdminBalance();
            }

            updateAdminBalance() {
                if (this.adminData) {
                    document.getElementById('adminBalance').textContent = 
                        '$' + this.adminData.balance.toLocaleString('en-US', { minimumFractionDigits: 2 });
                }
            }

            async loadAllData() {
                try {
                    // Load users
                    this.allUsers = this.storage.getAllUsers();
                    
                    // Load transactions
                    this.allTransactions = this.storage.getAllTransactions(200);
                    
                    // Load game history
                    this.allGames = this.storage.getAllGameHistory(100);
                    
                    // Calculate statistics
                    this.calculateStats();
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showAlert('Error loading data: ' + error.message, 'error');
                }
            }

            calculateStats() {
                const stats = this.storage.getAdminStats();
                
                document.getElementById('totalUsers').textContent = stats.totalUsers;
                document.getElementById('totalBalance').textContent = 
                    '$' + stats.totalPlatformBalance.toLocaleString('en-US', { minimumFractionDigits: 2 });
                document.getElementById('totalWins').textContent = 
                    '$' + stats.totalWins.toLocaleString('en-US', { minimumFractionDigits: 2 });
                document.getElementById('totalLosses').textContent = 
                    '$' + stats.totalLosses.toLocaleString('en-US', { minimumFractionDigits: 2 });
                
                // Update user codes datalist
                const datalist = document.getElementById('userCodes');
                datalist.innerHTML = this.allUsers.map(user => 
                    `<option value="${user.transactionCode}">${user.username} (${user.transactionCode})</option>`
                ).join('');
            }

            updateDisplay() {
                this.updateUsersTable();
                this.updateTransactionsLog();
            }

            updateUsersTable() {
                const tbody = document.getElementById('usersTableBody');
                if (this.allUsers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 3rem; color: #94a3b8;">
                                No users found. Users will appear here when they sign up.
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = this.allUsers.map(user => `
                    <tr>
                        <td><strong>${user.username}</strong></td>
                        <td>${user.email}</td>
                        <td><span class="password-display">‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè</span></td>
                        <td>$${user.balance.toFixed(2)}</td>
                        <td><span class="transaction-code">${user.transactionCode}</span></td>
                        <td>
                            <span style="color: ${user.status === 'active' ? '#10b981' : '#ef4444'}; 
                                  background: ${user.status === 'active' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'};
                                  padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;">
                                ${user.status}
                            </span>
                        </td>
                        <td>
                            <div class="win-loss-stats">
                                <div class="win-stat">W: $${user.totalWon.toFixed(2)}</div>
                                <div class="loss-stat">L: $${user.totalLost.toFixed(2)}</div>
                            </div>
                        </td>
                        <td>${new Date(user.created).toLocaleDateString()}</td>
                        <td>
                            <button class="user-action-btn" onclick="viewUserDetails('${user.username}')">View</button>
                            <button class="user-action-btn" onclick="editUserBalance('${user.username}')">Edit</button>
                        </td>
                    </tr>
                `).join('');
            }

            updateTransactionsLog() {
                const container = document.getElementById('transactionsLog');
                if (this.allTransactions.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: #94a3b8;">
                            No transactions yet. Transactions will appear here when users deposit, withdraw, or play games.
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.allTransactions.map(tx => `
                    <div class="transaction-item transaction-${tx.type}">
                        <div>
                            <strong>${tx.description || tx.type}</strong><br>
                            <small>
                                ${tx.from && tx.to ? `From: ${tx.from} ‚Üí To: ${tx.to}` : ''}
                                ${!tx.from && tx.to ? `To: ${tx.to}` : ''}
                                ${tx.from && !tx.to ? `From: ${tx.from}` : ''}
                            </small><br>
                            <small style="color: #94a3b8;">${new Date(tx.timestamp).toLocaleString()}</small>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.25rem; font-weight: bold; 
                                 color: ${tx.type === 'deposit' || tx.type === 'win' || (tx.type === 'transfer' && tx.to !== 'system') ? '#10b981' : 
                                         tx.type === 'withdrawal' || tx.type === 'loss' ? '#ef4444' : '#f59e0b'}">
                                ${(tx.type === 'deposit' || tx.type === 'win' || (tx.type === 'transfer' && tx.to !== 'system')) ? '+' : '-'}$${Math.abs(tx.amount).toFixed(2)}
                            </div>
                            <div class="transaction-code">${tx.id}</div>
                            <small style="color: #94a3b8; text-transform: capitalize;">${tx.type.replace('_', ' ')}</small>
                        </div>
                    </div>
                `).join('');
            }

            updateSyncStatus() {
                const statusEl = document.getElementById('syncStatus');
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                
                if (masterStore) {
                    statusEl.innerHTML = `
                        ‚úÖ <strong>Storage System Active</strong> | 
                        Version: ${masterStore.version} | 
                        Users: ${masterStore.totalUsers} | 
                        Last Updated: ${new Date(masterStore.lastUpdated).toLocaleTimeString()}
                    `;
                    statusEl.style.borderLeftColor = '#10b981';
                }
            }

            showAlert(message, type = 'success') {
                const container = document.getElementById('alertContainer');
                const alertId = 'alert-' + Date.now();
                
                const alertEl = document.createElement('div');
                alertEl.className = `alert alert-${type}`;
                alertEl.id = alertId;
                alertEl.innerHTML = `
                    ${type === 'success' ? '‚úÖ' : '‚ùå'} ${message}
                    <button onclick="document.getElementById('${alertId}').remove()" 
                            style="float: right; background: none; border: none; color: inherit; cursor: pointer;">‚úï</button>
                `;
                alertEl.style.display = 'block';
                
                container.appendChild(alertEl);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (document.getElementById(alertId)) {
                        document.getElementById(alertId).remove();
                    }
                }, 5000);
            }

            setupEventListeners() {
                // Auto-generate password and transaction code
                document.getElementById('newUsername').addEventListener('input', (e) => {
                    const username = e.target.value;
                    if (username.length >= 3) {
                        document.getElementById('newUserPassword').value = 
                            this.storage.generateStrongPassword(10);
                        document.getElementById('customTransactionCode').value = 
                            this.storage.generateTransactionCode(username);
                    }
                });
            }

            async forceSync() {
                this.showAlert('Syncing all data...', 'success');
                await this.loadAllData();
                this.updateDisplay();
                this.showAlert('Data sync complete!', 'success');
            }
        }

        // Initialize admin panel
        const admin = new AdminPanel();

        // MODAL FUNCTIONS
        function openDepositModal() {
            document.getElementById('depositModal').style.display = 'block';
        }

        function closeDepositModal() {
            document.getElementById('depositModal').style.display = 'none';
        }

        function openWithdrawModal() {
            // Load pending withdrawals
            const transactions = JSON.parse(localStorage.getItem('XBET_TRANSACTIONS') || '[]');
            const pending = transactions.filter(t => t.type === 'withdrawal' && t.status === 'pending');
            
            const list = document.getElementById('pendingWithdrawalsList');
            if (pending.length === 0) {
                list.innerHTML = '<div style="color: #94a3b8; padding: 1rem; text-align: center;">No pending withdrawals</div>';
            } else {
                list.innerHTML = pending.map(tx => `
                    <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px;">
                        <strong>${tx.id}</strong><br>
                        <small>User: ${tx.from} | Amount: $${tx.amount.toFixed(2)}</small><br>
                        <small>Date: ${new Date(tx.timestamp).toLocaleString()}</small>
                    </div>
                `).join('');
            }
            
            document.getElementById('withdrawModal').style.display = 'block';
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'none';
        }

        function openCreateUserModal() {
            document.getElementById('createUserModal').style.display = 'block';
        }

        function closeCreateUserModal() {
            document.getElementById('createUserModal').style.display = 'none';
        }

        function openAdminToAdminModal() {
            document.getElementById('adminToAdminModal').style.display = 'block';
        }

        function closeAdminToAdminModal() {
            document.getElementById('adminToAdminModal').style.display = 'none';
        }

        function openGameResultsModal() {
            document.getElementById('gameResultsModal').style.display = 'block';
        }

        function closeGameResultsModal() {
            document.getElementById('gameResultsModal').style.display = 'none';
        }

        // PROCESSING FUNCTIONS
        async function processUserDeposit() {
            const userCode = document.getElementById('depositUserCode').value.trim();
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const description = document.getElementById('depositDescription').value.trim();

            if (!userCode || !amount || amount <= 0) {
                admin.showAlert('Please enter valid user code and amount', 'error');
                return;
            }

            try {
                const user = admin.storage.getUserByTransactionCode(userCode);
                if (!user) {
                    admin.showAlert('User not found with that transaction code', 'error');
                    return;
                }

                // Check admin balance
                if (admin.adminData.balance < amount) {
                    admin.showAlert('Insufficient admin balance', 'error');
                    return;
                }

                // Update admin balance
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                masterStore.admins[admin.currentAdmin].balance -= amount;
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));

                // Record transaction
                admin.storage.recordTransaction({
                    type: 'deposit',
                    from: admin.currentAdmin,
                    to: user.username,
                    amount: amount,
                    description: description || 'Admin deposit',
                    status: 'completed',
                    category: 'admin_deposit'
                });

                // Update user balance
                admin.storage.updateUserBalance(user.username, amount, 'deposit');

                admin.showAlert(`‚úÖ Deposited $${amount.toFixed(2)} to ${user.username}`, 'success');
                closeDepositModal();
                
                // Refresh data
                admin.loadAdminData();
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        async function processWithdrawalStatus() {
            const withdrawalCode = document.getElementById('withdrawalCode').value.trim();
            const status = document.getElementById('withdrawalStatus').value;

            if (!withdrawalCode) {
                admin.showAlert('Please enter withdrawal code', 'error');
                return;
            }

            try {
                const transactions = JSON.parse(localStorage.getItem('XBET_TRANSACTIONS'));
                const txIndex = transactions.findIndex(t => t.id === withdrawalCode && t.type === 'withdrawal');
                
                if (txIndex === -1) {
                    admin.showAlert('Withdrawal transaction not found', 'error');
                    return;
                }

                const tx = transactions[txIndex];
                tx.status = status;
                tx.processedBy = admin.currentAdmin;
                tx.processedAt = new Date().toISOString();

                if (status === 'completed') {
                    tx.completedAt = new Date().toISOString();
                    // Transfer from admin to system (already deducted from user when requested)
                    admin.storage.recordTransaction({
                        type: 'admin_transfer',
                        from: admin.currentAdmin,
                        to: 'system',
                        amount: tx.amount,
                        description: `Withdrawal processed for ${tx.from}`,
                        status: 'completed'
                    });
                } else if (status === 'rejected') {
                    // Refund to user
                    admin.storage.updateUserBalance(tx.from, tx.amount, 'deposit');
                    admin.storage.recordTransaction({
                        type: 'refund',
                        from: 'system',
                        to: tx.from,
                        amount: tx.amount,
                        description: 'Withdrawal rejected - refund',
                        status: 'completed'
                    });
                }

                localStorage.setItem('XBET_TRANSACTIONS', JSON.stringify(transactions));
                admin.showAlert(`‚úÖ Withdrawal ${status} successfully!`, 'success');
                closeWithdrawModal();
                
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        async function createNewUser() {
            const username = document.getElementById('newUsername').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const balance = parseFloat(document.getElementById('initialBalance').value) || 0;
            const password = document.getElementById('newUserPassword').value;

            if (!username || !email || !password) {
                admin.showAlert('Please fill all required fields', 'error');
                return;
            }

            if (username.length < 3) {
                admin.showAlert('Username must be at least 3 characters', 'error');
                return;
            }

            if (!email.includes('@') || !email.includes('.')) {
                admin.showAlert('Please enter valid email', 'error');
                return;
            }

            if (balance > 10000) {
                admin.showAlert('Maximum initial balance is $10,000', 'error');
                return;
            }

            try {
                const result = admin.storage.registerUser(username, email, password, balance);
                admin.showAlert(`‚úÖ User ${username} created successfully! Transaction Code: ${result.user.transactionCode}`, 'success');
                closeCreateUserModal();
                
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        async function processAdminToAdminTransfer() {
            const fromAdmin = document.getElementById('fromAdmin').value;
            const toAdmin = document.getElementById('toAdmin').value;
            const amount = parseFloat(document.getElementById('adminTransferAmount').value);
            const description = document.getElementById('adminTransferDescription').value.trim();

            if (!amount || amount <= 0) {
                admin.showAlert('Please enter valid amount', 'error');
                return;
            }

            try {
                const masterStore = JSON.parse(localStorage.getItem('XBET_MASTER_STORE'));
                
                if (masterStore.admins[fromAdmin].balance < amount) {
                    admin.showAlert('Insufficient balance in source admin account', 'error');
                    return;
                }

                // Update balances
                masterStore.admins[fromAdmin].balance -= amount;
                masterStore.admins[toAdmin].balance += amount;
                localStorage.setItem('XBET_MASTER_STORE', JSON.stringify(masterStore));

                // Record transaction
                admin.storage.recordTransaction({
                    type: 'admin_transfer',
                    from: fromAdmin,
                    to: toAdmin,
                    amount: amount,
                    description: description || 'Admin transfer',
                    status: 'completed'
                });

                admin.showAlert(`‚úÖ Transferred $${amount.toFixed(2)} from ${fromAdmin} to ${toAdmin}`, 'success');
                closeAdminToAdminModal();
                
                admin.loadAdminData();
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        async function processUniversalTransfer() {
            const fromType = document.getElementById('transferFrom').value;
            const toType = document.getElementById('transferTo').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const code = document.getElementById('transactionCode').value.trim();

            if (!amount || amount <= 0) {
                admin.showAlert('Please enter valid amount', 'error');
                return;
            }

            if (!code) {
                admin.showAlert('Please enter transaction code', 'error');
                return;
            }

            try {
                const user = admin.storage.getUserByTransactionCode(code);
                if (!user && (fromType === 'user' || toType === 'user')) {
                    admin.showAlert('User not found with that transaction code', 'error');
                    return;
                }

                let fromUser = fromType === 'user' ? user.username : fromType === 'admin' ? admin.currentAdmin : '';
                let toUser = toType === 'user' ? user.username : toType === 'admin' ? admin.currentAdmin : '';

                // Admin to User
                if (fromType === 'admin' && toType === 'user') {
                    if (admin.adminData.balance < amount) {
                        admin.showAlert('Insufficient admin balance', 'error');
                        return;
                    }
                    
                    admin.storage.recordTransaction({
                        type: 'deposit',
                        from: admin.currentAdmin,
                        to: user.username,
                        amount: amount,
                        description: 'Admin transfer to user',
                        status: 'completed'
                    });

                    admin.showAlert(`‚úÖ Transferred $${amount.toFixed(2)} to ${user.username}`, 'success');
                }
                // User to Admin
                else if (fromType === 'user' && toType === 'admin') {
                    if (user.balance < amount) {
                        admin.showAlert('User has insufficient balance', 'error');
                        return;
                    }

                    admin.storage.recordTransaction({
                        type: 'transfer',
                        from: user.username,
                        to: admin.currentAdmin,
                        amount: amount,
                        description: 'User transfer to admin',
                        status: 'completed'
                    });

                    admin.showAlert(`‚úÖ Received $${amount.toFixed(2)} from ${user.username}`, 'success');
                }

                // Clear form
                document.getElementById('transferAmount').value = '';
                document.getElementById('transactionCode').value = '';
                
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        async function processManualGameResult() {
            const userCode = document.getElementById('gameUserCode').value.trim();
            const gameType = document.getElementById('gameType').value;
            const result = document.getElementById('gameResult').value;
            const amount = parseFloat(document.getElementById('gameAmount').value);
            const details = document.getElementById('gameDetails').value.trim();

            if (!userCode || !amount || amount <= 0) {
                admin.showAlert('Please enter valid user code and amount', 'error');
                return;
            }

            try {
                const user = admin.storage.getUserByTransactionCode(userCode);
                if (!user) {
                    admin.showAlert('User not found with that transaction code', 'error');
                    return;
                }

                if (result === 'loss' && user.balance < amount) {
                    admin.showAlert('User has insufficient balance for loss', 'error');
                    return;
                }

                const gameRecord = admin.storage.recordGameResult(
                    user.username,
                    gameType,
                    result,
                    amount,
                    details
                );

                admin.showAlert(`‚úÖ Game result recorded: ${user.username} ${result} $${amount.toFixed(2)} in ${gameType}`, 'success');
                closeGameResultsModal();
                
                await admin.loadAllData();
                admin.updateDisplay();

            } catch (error) {
                admin.showAlert('Error: ' + error.message, 'error');
            }
        }

        // UTILITY FUNCTIONS
        function searchUsers(query) {
            const rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query.toLowerCase()) ? '' : 'none';
            });
        }

        function filterTransactions(filter) {
            const items = document.querySelectorAll('.transaction-item');
            items.forEach(item => {
                const type = item.className.includes('transaction-' + filter);
                item.style.display = filter === 'all' || type ? '' : 'none';
            });
        }

        function viewUserDetails(username) {
            const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
            const user = usersData[username];
            
            if (user) {
                alert(`
                    üë§ User Details: ${username}
                    
                    üìß Email: ${user.email}
                    üí∞ Balance: $${user.balance.toFixed(2)}
                    üîë Transaction Code: ${user.transactionCode}
                    
                    üìä Statistics:
                    ‚Ä¢ Total Deposited: $${user.totalDeposited.toFixed(2)}
                    ‚Ä¢ Total Withdrawn: $${user.totalWithdrawn.toFixed(2)}
                    ‚Ä¢ Total Won: $${user.totalWon.toFixed(2)}
                    ‚Ä¢ Total Lost: $${user.totalLost.toFixed(2)}
                    
                    üìÖ Account Created: ${new Date(user.created).toLocaleString()}
                    üîê Last Login: ${new Date(user.lastLogin).toLocaleString()}
                    üìç Status: ${user.status}
                `);
            }
        }

        function editUserBalance(username) {
            const usersData = JSON.parse(localStorage.getItem('XBET_USERS_DATA'));
            const user = usersData[username];
            
            if (user) {
                const newBalance = prompt(`Edit balance for ${username}\nCurrent: $${user.balance.toFixed(2)}\nEnter new balance:`, user.balance);
                
                if (newBalance !== null) {
                    const balance = parseFloat(newBalance);
                    if (!isNaN(balance) && balance >= 0) {
                        user.balance = balance;
                        localStorage.setItem('XBET_USERS_DATA', JSON.stringify(usersData));
                        admin.showAlert(`‚úÖ Updated ${username}'s balance to $${balance.toFixed(2)}`, 'success');
                        admin.updateDisplay();
                    } else {
                        admin.showAlert('Invalid balance amount', 'error');
                    }
                }
            }
        }

        function adminLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('admin_session');
                localStorage.removeItem('admin_user');
                window.location.href = 'admin.login.html';
            }
        }

        async function forceSync() {
            await admin.forceSync();
        }

        // Update transfer options
        function updateTransferOptions() {
            const from = document.getElementById('transferFrom').value;
            const to = document.getElementById('transferTo').value;
            
            // Prevent same type transfers
            if (from === to) {
                document.getElementById('transferTo').selectedIndex = 
                    (document.getElementById('transferTo').selectedIndex + 1) % 3;
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            const modals = ['depositModal', 'withdrawModal', 'createUserModal', 'adminToAdminModal', 'gameResultsModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDepositModal();
                closeWithdrawModal();
                closeCreateUserModal();
                closeAdminToAdminModal();
                closeGameResultsModal();
            }
            
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                forceSync();
            }
            
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                openCreateUserModal();
            }
            
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                openDepositModal();
            }
            
            if (e.ctrlKey && e.key === 'g') {
                e.preventDefault();
                openGameResultsModal();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            admin.init();
            
            // Auto-focus search box
            setTimeout(() => {
                const searchBox = document.querySelector('.search-box');
                if (searchBox) searchBox.focus();
            }, 500);
            
            // Show welcome message
            setTimeout(() => {
                const adminName = document.getElementById('adminUsername').textContent;
                console.log(`üëë Welcome, ${adminName}! X-BET Admin Panel v5.0 loaded successfully.`);
                console.log(`üîí Storage System: Centralized secure storage active`);
                console.log(`üìä Total Users: ${admin.allUsers.length}`);
            }, 1000);
        });

        // Export admin globally
        window.admin = admin;
        window.XBetStorage = XBetStorage;
    </script>
</body>
</html>
