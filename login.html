<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-BET | Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... keep your existing login styles ... */
        /* Just adding the critical JavaScript fix */
    </style>
</head>
<body>
    <!-- ... keep your existing HTML structure ... -->
    
    <script>
        // ===== FORM VALIDATION =====
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Validation
            if (!username || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            // Check if user exists in registeredUsers
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '{}');
            
            if (registeredUsers[username]) {
                // User exists, check password (demo mode - in real system, you'd verify properly)
                const userData = JSON.parse(localStorage.getItem('userData_' + username) || '{}');
                
                // For demo, accept any password if user exists
                if (userData.password === password || !userData.password) {
                    // Login successful
                    localStorage.setItem('xbet_token', 'token_' + Date.now());
                    localStorage.setItem('currentUser', username);
                    
                    // Update last login
                    userData.lastLogin = new Date().toISOString();
                    localStorage.setItem('userData_' + username, JSON.stringify(userData));
                    
                    // Generate transaction code if not exists
                    if (!userData.transactionCode) {
                        userData.transactionCode = generateTransactionCode(username);
                        localStorage.setItem('userData_' + username, JSON.stringify(userData));
                    }
                    
                    alert('Login successful! Redirecting to dashboard...');
                    window.location.href = 'dashboard.html';
                } else {
                    alert('Invalid password');
                }
            } else {
                // New user - create account
                if (confirm('New user detected. Create account with these credentials?')) {
                    // Create user in registeredUsers
                    registeredUsers[username] = username + '@xbet.com';
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    
                    // Create user data with proper structure
                    const userData = {
                        username: username,
                        email: username + '@xbet.com',
                        password: password,
                        balance: 0,
                        transactionCode: generateTransactionCode(username),
                        isAdmin: false,
                        status: 'active',
                        registeredAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        activities: []
                    };
                    
                    localStorage.setItem('userData_' + username, JSON.stringify(userData));
                    localStorage.setItem('xbet_token', 'token_' + Date.now());
                    localStorage.setItem('currentUser', username);
                    
                    alert('Account created successfully! Your transaction code has been generated. Redirecting to dashboard...');
                    window.location.href = 'dashboard.html';
                }
            }
        });
        
        function generateTransactionCode(username) {
            const prefix = username.substring(0, 3).toUpperCase();
            const timestamp = Date.now().toString(36).toUpperCase().substr(-8);
            const random = Math.random().toString(36).substr(2, 8).toUpperCase();
            return `XBT-${prefix}-${timestamp}-${random}`;
        }
    </script>
</body>
</html>
